@{
    ViewData["Title"] = "Home Page";
}
<div class="text-center header-padding">
    <h1><strong>Welcome to the Ping Pong Center!</strong></h1>
</div>
<div class="row">
    <!-- PLAYER INFO + SCORES -->
    <div class="col-lg-6 container-border">
        <p class="text-center">Enter the outcome of a completed game here!</p>
        <div>
            <div class="col-lg-6">
                <form>
                    <h4 class="text-center"><strong>Player 1</strong></h4>
                    <div class="form-group">
                        <label for="Player1Name">Name:</label>
                        <input type="text" class="form-control" id="Player1Name" placeholder="First Last">
                    </div>
                    <div class="form-group">
                        <label for="Player1Score">Score:</label>
                        <input type="int" class="form-control" id="Player1Score" placeholder="0">
                    </div>
                </form>
            </div>
            <div class="col-lg-6">
                <form>
                    <h4 class="text-center"><strong>Player 2</strong></h4>
                    <div class="form-group">
                        <label for="Player2Name">Name:</label>
                        <input type="text" class="form-control" id="Player2Name" placeholder="First Last">
                    </div>
                    <div class="form-group">
                        <label for="Player2Score">Score:</label>
                        <input type="int" class="form-control" id="Player2Score" placeholder="0">
                    </div>
                    
                </form>
            </div>
            <div class="text-center">
            <button role="submit" id="submitScore">Submit</button>
            </div>
        </div>    
    </div>
    <!-- LeaderBoard -->
    <div class="col-lg-6">
        <span>
            <h2 class="text-center">Leader Board</h2>
            <table id="leaderboard" width="100%" class="table table-striped table-spacing-left">
                <thead class="text-center">
                    <td width="10%">Rank</td>
                    <td width="50%">Player Name</td>
                    <td width="20%">Wins</td>
                    <td width="20%">Losses</td>
                </thead>
                <!-- For each player in the list object, repeat and display in the table -->
            </table>
        </span>
    </div>
</div>

    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script>
        $("#submitScore").click(function () {
            console.log('gets here');
            var options = {};
            options.url = "http://localhost:5000/api/games";
            options.type = "POST";          

            var playerOneObj = {
                Name : $("#Player1Name").val()
            };            

            var playerTwoObj = {
                Name : $("#Player2Name").val()
            };

            var gameObj = {
                PlayerOne : playerOneObj, 
                PlayerOneScore: $("#Player1Score").val(), 
                PlayerTwo : playerTwoObj, 
                PlayerTwoScore : $("#Player2Score").val(), 
            };

            options.data = JSON.stringify(gameObj);

            options.contentType = "application/json";
            options.dataType = "html";

            console.log('options: ' + JSON.stringify(options));

            options.success = function (msg) {
                alert('Game Submitted');
                updateLeaderboard();
            };
            options.error = function () {
                alert('options.error: ' + options.error);
            };
            $.ajax(options);
        })
        $( "#leaderboard" ).ready(function() {
            console.log( "ready!" );
            updateLeaderboard();
        });
        function buildLeaderboard(players) {
            $('#leaderboard tbody').empty();
            var table = document.getElementById('leaderboard');
            var tableBody = document.createElement('tbody');

            players.forEach(function(player, index) {
                console.log(index, " | Player: ", player);
                var row =generateRow(player, index);
                tableBody.appendChild(row);
            });

            table.appendChild(tableBody);
        }
        function generateRow(player, index) {
            console.log("index:", index);
            var row = document.createElement('tr');
            var rank = document.createElement('td');
            rank.appendChild(document.createTextNode(index+1+'.'));
            row.appendChild(rank);
            var name = document.createElement('td');
            name.appendChild(document.createTextNode(toTitleCase(player.name)));
            name.className += "text-center ";
            row.appendChild(name);
            var wins = document.createElement('td');
            wins.appendChild(document.createTextNode(player.numberWins));
            wins.className += "text-center ";
            row.appendChild(wins);
            var losses = document.createElement('td');
            losses.appendChild(document.createTextNode(player.numberLosses));
            losses.className += "text-center ";
            row.appendChild(losses);

            return row
        }
        function updateLeaderboard() {
            var options = {
                type: "GET",
                url: "http://localhost:5000/api/players/leaderboard"
            };
            options.success = function (leaderboard) {
                console.log("Leaderboard:", leaderboard);
                buildLeaderboard(leaderboard);
                alert('Fetched Leaderboard!');
            };
            options.error = function () {
                alert('options.error: ' + options.error);
            };
            $.ajax(options);
        }
        function toTitleCase(str)
        {
            return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
        }
    </script>   